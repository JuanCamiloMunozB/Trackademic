<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Trackademic | Evaluation Plans</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <!-- Optional: Link to a specific CSS file for this page if you create one -->
    <!-- <link rel="stylesheet" th:href="@{/css/evaluation-plans.css}" /> -->

</head>
<body>
    <header class="py-3 border-bottom bg-white shadow-sm">
        <div class="container d-flex justify-content-between align-items-center">
            <h1 class="h4 text-primary fw-bold mb-0">Trackademic</h1>
            <!-- Button to go back to Dashboard -->
            <nav>
                 <a th:href="@{/dashboard}" class="btn btn-sm btn-outline-secondary">
                    <i class="bi bi-arrow-left me-1"></i> Back to Dashboard <!-- Changed text and icon -->
                 </a>
            </nav>
        </div>
    </header>

    <main class="container my-5">

        <h2 class="mb-4 fw-bold text-primary text-center">Evaluation Plan Templates</h2>

        <div class="card card-custom mb-4 shadow-sm">
            <div class="card-header bg-light">
                <h3 class="h5 mb-0 fw-semibold">Filter Plans</h3>
            </div>
            <div class="card-body">
                <form id="filterForm" method="get" th:action="@{/evaluation-plans/search}">
                    <div class="row g-3 align-items-end">

                        <div class="col-md-6 col-lg-3">
                            <label for="subjectCodeInput" class="form-label">Subject Code:</label>
                            <input type="text" class="form-control" id="subjectCodeInput" name="subjectCode" th:value="${selectedSubjectCode}" placeholder="Enter Code" style="text-transform: uppercase;"/>
                        </div>

                        <div class="col-md-6 col-lg-3">
                             <label for="subjectNameSelect" class="form-label">Subject Name:</label>
                             <select class="form-select" id="subjectNameSelect" name="subjectName">
                                  <option value="">-- Select Subject Name --</option>
                                   <option th:each="subject : ${subjects}"
                                           th:value="${subject.name}"
                                           th:text="${subject.name}"
                                           th:selected="${subject.name == selectedSubjectName}"></option>
                              </select>
                        </div>

                        <div class="col-md-4 col-lg-2">
                            <label for="groupSelect" class="form-label">Group Number:</label>
                             <select class="form-select" id="groupSelect" name="groupId">
                                 <option value="">-- Select Group --</option>
                                 <option th:each="group : ${groups}"
                                         th:value="${group.number}"
                                         th:text="${group.number} + ' (' + ${group.semester} + ')'"
                                         th:selected="${group.number != null and group.number.toString() == selectedGroupId}"></option>
                             </select>
                        </div>

                        <div class="col-md-8 col-lg-4">
                             <label for="professorSelect" class="form-label">Professor:</label>
                              <select class="form-select" id="professorSelect" name="professorId">
                                  <option value="">-- Select Professor --</option>
                                  <option th:each="professor : ${professors}"
                                          th:value="${professor.id}"
                                          th:text="${professor.firstName} + ' ' + ${professor.lastName}"
                                          th:selected="${professor.id == selectedProfessorId}"></option>
                              </select>
                        </div>

                        <div class="col-md-4 col-lg-2">
                            <label for="semesterSelect" class="form-label">Semester:</label>
                             <select class="form-select" id="semesterSelect" name="semester">
                                 <option value="">-- Select Semester --</option>
                                 <option th:each="sem : ${semestersList}"
                                         th:value="${sem}"
                                         th:text="${sem}"
                                         th:selected="${sem == selectedSemester}"></option>
                             </select>
                        </div>

                         <div class="col-md-8 col-lg-4 d-flex justify-content-md-start justify-content-center">
                             <button type="submit" class="btn btn-primary me-2">
                                <i class="bi bi-search me-1"></i> Search/Filter
                             </button>
                             <button type="button" class="btn btn-secondary" onclick="resetForm()">
                                <i class="bi bi-x-circle me-1"></i> Reset
                             </button>
                         </div>

                    </div>
                </form>
            </div>
        </div>


        <table class="table table-striped table-bordered table-hover">
            <thead class="table-light">
                <tr>
                    <th>Subject Code</th>
                    <th>Subject Name</th>
                    <th>Group ID</th>
                    <th>Professor</th>
                    <th>Semester</th>
                    <th>Activities</th>
                    <th>Actions</th> <!-- New column header for buttons -->
                </tr>
            </thead>
            <tbody>
                <tr th:each="plan : ${evaluationPlans}">
                    <td th:text="${plan.subjectCode}">Subject Code</td>
                    <td th:text="${plan.subjectName}">Subject Name</td>
                    <td th:text="${plan.groupId}">Group ID</td>
                    <td th:text="${plan.professor}">Professor Name</td>
                    <td th:text="${plan.semester}">Semester</td>
                    <td>
                        <ul>
                            <li th:each="activity : ${plan.activities}">
                                <span th:text="${activity.name}">Activity Name</span>
                                (<span th:text="${activity.percentage}">%</span>% - Grade: <span th:text="${activity.grade}">Grade</span>)
                            </li>
                        </ul>
                    </td>
                    <td>
                        <!-- Button to view the plan details -->
                        <!-- Uses the plan's ID to create the URL -->
                        <!-- target="_blank" opens in a new tab -->
                        <a th:href="@{/evaluation-plans/{id}(id=${plan.id})}" target="_blank" class="btn btn-sm btn-outline-info">
                            <i class="bi bi-eye me-1"></i> View Plan
                        </a>
                    </td>
                </tr>
                 <tr th:if="${evaluationPlans.empty}">
                      <!-- Adjust colspan to 7 (6 + 1 for the new column) -->
                      <td colspan="7" class="text-center text-muted">No evaluation plans found matching the criteria.</td>
                  </tr>
            </tbody>
        </table>

    </main>

    <footer class="py-4 mt-auto bg-light text-center text-muted">
        Â© 2025 Trackademic. Todos los derechos reservados.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
        const subjectCodeInput = document.getElementById("subjectCodeInput");
        if (subjectCodeInput) {
            subjectCodeInput.addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
        }

        function resetForm() {
            document.getElementById("subjectCodeInput").value = "";
            document.getElementById("subjectNameSelect").value = "";
            document.getElementById("groupSelect").value = "";
            document.getElementById("professorSelect").value = "";
            document.getElementById("semesterSelect").value = "";
            document.getElementById("filterForm").submit();
        }
    </script>

</body>
</html>